# Dictionnaire des sites avec les mots-clés associés

sites = {
    "lille":["chiclet-1","chiclet-2","chiclet-3","chiclet-4","chiclet-5","chiclet-6","chiclet-7","chiclet-8","chifflot-1",
             "chifflot-2","chifflot-3","chifflot-4","chifflot-5","chifflot-6","chifflot-7","chifflot-8"],
    "grenoble": ["dahu-1","dahu-2","dahu-3","dahu-4","dahu-5","dahu-6","dahu-7","dahu-8","dahu-9","dahu-10","dahu-11",
                 "dahu-12","dahu-13","dahu-14","dahu-15","dahu-16","dahu-17","dahu-18","dahu-19","dahu-20","dahu-21",
                 "dahu-22","dahu-23","dahu-24","dahu-25","dahu-26","dahu-27","dahu-28","dahu-29","dahu-30","dahu-31",
                 "dahu-32","drac-1","drac-2","drac-3","drac-4","drac-5","drac-6","drac-7","drac-8","drac-9","drac-10",
                 "drac-11","drac-12","servan-1","servan-2","troll-1","troll-2","troll-3","troll-4","yeti-1","yeti-2",
                 "yeti-3","yeti-"],
    "lyon": ["gemini-1","gemini-2","hercule-1","hercule-2","hercule-3","hercule-4","neowise-1","neowise-2","neowise-3",
             "neowise-4","neowise-5","neowise-6","neowise-7","neowise-8","neowise-9","neowise-10","nova-1","nova-2",
             "nova-3","nova-4","nova-5","nova-6","nova-7","nova-8","nova-9","nova-10","nova-11","nova-12","nova-13",
             "nova-14","nova-15","nova-16","nova-17","nova-18","nova-19","nova-21","nova-22","nova-23","orion-1",
             "orion-3","orion-4","pyxis-1","pyxis-2","pyxis-3","pyxis-4","sagittaire-2","sagittaire-3","sagittaire-4",
             "sagittaire-5","sagittaire-11","sagittaire-12","sagittaire-13","sagittaire-14","sagittaire-15",
             "sagittaire-16","sirius-1","taurus-1","taurus-3","taurus-4","taurus-5","taurus-6","taurus-7","taurus-8",
             "taurus-9","taurus-10","taurus-11","taurus-13","taurus-15"],
    "nancy": ["gros-1","gros-2","gros-3","gros-4","gros-5","gros-6","gros-7","gros-8","gros-9","gros-10","gros-11",
              "gros-12","gros-13","gros-14","gros-15","gros-16","gros-17","gros-18","gros-19","gros-20","gros-21",
              "gros-22","gros-23","gros-24","gros-25","gros-26","gros-27","gros-28","gros-29","gros-30","gros-31",
              "gros-32","gros-33","gros-34","gros-35","gros-36","gros-37","gros-38","gros-39","gros-40","gros-41",
              "gros-42","gros-43","gros-44","gros-45","gros-46","gros-47","gros-48","gros-49","gros-50","gros-51",
              "gros-52","gros-53","gros-54","gros-55","gros-56","gros-57","gros-58","gros-59","gros-60","gros-61",
              "gros-62","gros-63","gros-64","gros-65","gros-66","gros-67","gros-68","gros-69","gros-70","gros-71",
              "gros-72","gros-73","gros-74","gros-75","gros-76","gros-77","gros-78","gros-79","gros-80","gros-81",
              "gros-82","gros-83","gros-84","gros-85","gros-86","gros-87","gros-88","gros-89","gros-90","gros-91",
              "gros-92","gros-93","gros-94","gros-95","gros-96","gros-97","gros-98","gros-99","gros-100","gros-101",
              "gros-102","gros-103","gros-104","gros-105","gros-106","gros-107","gros-108","gros-109","gros-110",
              "gros-111","gros-112","gros-113","gros-114","gros-115","gros-116","gros-117","gros-118","gros-119",
              "gros-120","gros-121","gros-122","gros-123","gros-124","grouille-1","grouille-2"],
    "nantes": ["econome-1","econome-2","econome-3","econome-4","econome-5","econome-6","econome-7","econome-8",
               "econome-9","econome-10","econome-11","econome-12","econome-13","econome-14","econome-15",
               "econome-16","econome-17","econome-18","econome-19","econome-20","econome-21","econome-22",
               "ecotype-1","ecotype-2","ecotype-3","ecotype-4","ecotype-5","ecotype-6","ecotype-7","ecotype-8",
               "ecotype-9","ecotype-10","ecotype-11","ecotype-12","ecotype-13","ecotype-14","ecotype-15",
               "ecotype-16","ecotype-17","ecotype-18","ecotype-19","ecotype-20","ecotype-21","ecotype-22",
               "ecotype-23","ecotype-24","ecotype-25","ecotype-26","ecotype-27","ecotype-28","ecotype-29",
               "ecotype-30","ecotype-31","ecotype-32","ecotype-33","ecotype-34","ecotype-35","ecotype-36",
               "ecotype-37","ecotype-38","ecotype-39","ecotype-40","ecotype-41","ecotype-42","ecotype-43",
               "ecotype-44","ecotype-45","ecotype-46","ecotype-47","ecotype-48"],
    "rennes": ["paranoia-1","paranoia-2","paranoia-3","paranoia-4","paranoia-5","paranoia-7","paranoia-8",
               "parasilo-1","parasilo-2","parasilo-3","parasilo-4","parasilo-5","parasilo-6","parasilo-7",
               "parasilo-8","parasilo-9","parasilo-10","parasilo-11","parasilo-12","parasilo-13","parasilo-14",
               "parasilo-15","parasilo-17","parasilo-18","parasilo-19","parasilo-20","parasilo-21","parasilo-22",
               "parasilo-23","parasilo-24","parasilo-25","parasilo-26","parasilo-27","parasilo-28","paravance-1",
               "paravance-2","paravance-3","paravance-4","paravance-5","paravance-6","paravance-7","paravance-8",
               "paravance-9","paravance-10","paravance-11","paravance-12","paravance-13","paravance-14",
               "paravance-15","paravance-16","paravance-17","paravance-18","paravance-19","paravance-20",
               "paravance-21","paravance-22","paravance-23","paravance-24","paravance-25","paravance-26",
               "paravance-27","paravance-28","paravance-29","paravance-30","paravance-31","paravance-32",
               "paravance-33","paravance-34","paravance-35","paravance-36","paravance-37","paravance-38",
               "paravance-39","paravance-40","paravance-41","paravance-42","paravance-43","paravance-44",
               "paravance-45","paravance-46","paravance-47","paravance-48","paravance-49","paravance-50",
               "paravance-51","paravance-52","paravance-53","paravance-54","paravance-55","paravance-56",
               "paravance-57","paravance-58","paravance-59","paravance-60","paravance-61","paravance-62",
               "paravance-63","paravance-64","paravance-65","paravance-66","paravance-67","paravance-68",
               "paravance-69","paravance-70","paravance-71","paravance-72"],
    "toulouse": ["estats-1","estats-2","estats-3","estats-4","estats-5","estats-6","estats-7","estats-8","estats-9",
                 "estats-10","estats-11","montcalm-1","montcalm-2","montcalm-3","montcalm-4","montcalm-5",
                 "montcalm-6","montcalm-7","montcalm-8","montcalm-9","montcalm-10"]
}

def label_node(node_name):
    """Retourne le site associé au nœud Kubernetes en fonction de son nom"""
    for site, keywords in sites.items():
        if any(keyword in node_name for keyword in keywords):
            return site
    return "unknown"
import subprocess

def get_kubernetes_nodes():
    """Exécute 'kubectl get nodes' pour récupérer la liste des nœuds Kubernetes."""
    try:
        result = subprocess.run(['kubectl', 'get', 'nodes', '-o', 'name'], capture_output=True, text=True, check=True)
        nodes = result.stdout.strip().split('\n')
        return [node.split('/')[-1] for node in nodes]  # Récupérer juste le nom des nœuds
    except subprocess.CalledProcessError as e:
        print(f"Erreur lors de l'exécution de 'kubectl get nodes': {e}")
        return []

def label_node(node_name):
    """Retourne le site associé au nœud Kubernetes en fonction de son nom."""
    for site, keywords in sites.items():
        if any(keyword in node_name for keyword in keywords):
            return site
    return "unknown"

def label_kubernetes_nodes():
    """Récupère les nœuds et les labellise en fonction de leur site."""
    nodes = get_kubernetes_nodes()
    
    for node in nodes:
        site_label = label_node(node)
        if site_label != "unknown":
            try:
                # Ajout du label site=<site_label> au nœud
                subprocess.run(['kubectl', 'label', 'node', node, f'site={site_label}', '--overwrite'], check=True)
                print(f"Nœud {node} labellisé avec site={site_label}")
            except subprocess.CalledProcessError as e:
                print(f"Erreur lors du labellisation du nœud {node}: {e}")
        else:
            print(f"Nœud {node} non reconnu, aucun label ajouté.")

# Exemple d'exécution
label_kubernetes_nodes()


